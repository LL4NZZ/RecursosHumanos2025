{% extends "base_admin.html" %}

{% block title %}Gesti贸n de Documentos{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    
    <h2>Gesti贸n de Documentos de Empleados</h2>
    <p class="text-secondary">Revisa, aprueba, rechaza y descarga documentos subidos por el personal.</p>

    <ul class="nav nav-tabs" id="documentTabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="pendientes-tab" data-toggle="tab" href="#pendientes" role="tab">
                Pendientes de Revisi贸n (<span id="count-pendientes">5</span>)
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="aprobados-tab" data-toggle="tab" href="#aprobados" role="tab">
                Aprobados
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="rechazados-tab" data-toggle="tab" href="#rechazados" role="tab">
                Rechazados
            </a>
        </li>
    </ul>

    <div class="tab-content mt-3" id="documentTabsContent">
        
        <div class="tab-pane fade show active" id="pendientes" role="tabpanel">
            <h4>Documentos Pendientes</h4>
            {% if documentos_pendientes %}
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Tipo de Documento</th>
                            <th>Fecha de Carga</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for doc in documentos_pendientes %}
                        <tr>
                            <td>{{ doc.Nombres }} {{ doc.Apellidos }}</td>
                            <td>{{ doc.TipoDocumento }}</td>
                            <td>{{ doc.FechaCarga | default("N/A") }}</td>
                            <td>
                                <a href="{{ url_for('descargar_adjunto', filename=doc.RutaArchivo) }}" 
                                   target="_blank" class="btn btn-sm btn-info">
                                    <i class="fa fa-download"></i> Ver/Descargar
                                </a>
                                <a href="?id={{ doc.IdDocumento }}&accion=aprobar" class="btn btn-sm btn-success">
                                    Aprobar
                                </a>
                                <button type="button" class="btn btn-sm btn-danger" 
                                        data-toggle="modal" data-target="#rechazarModal{{ doc.IdDocumento }}">
                                    Rechazar
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-success">No hay documentos pendientes de revisi贸n. </div>
            {% endif %}
        </div>
        
        <div class="tab-pane fade" id="aprobados" role="tabpanel">
            <h4>Historial de Aprobados</h4>
            <p>Aqu铆 se cargar铆a una tabla similar usando los datos de `documentos_aprobados`.</p>
        </div>

        <div class="tab-pane fade" id="rechazados" role="tabpanel">
            <h4>Historial de Rechazados</h4>
            <p>Aqu铆 se cargar铆a una tabla similar usando los datos de `documentos_rechazados`.</p>
        </div>

    </div>
</div>

{% include "modals/rechazo_documento.html" %}

{% endblock %}