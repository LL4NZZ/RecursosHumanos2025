{% extends "base_vendedora.html" %}
{% block title %}Gestión de Carteras{% endblock %}
{% block content %}

<div class="container my-5">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/cartera.css') }}">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold">Gestión de Carteras de Clientes</h3>

        <button class="btn btn-primary px-4" data-bs-toggle="modal" data-bs-target="#modalCrearCartera">
            <i class="fa-solid fa-folder-plus me-2"></i>Crear Nueva Cartera
        </button>
    </div>

    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Vendedor</th>
                        <th>Nombre Contacto</th>
                        <th>Teléfono</th>
                        <th>Correo</th>
                        <th>Fecha Asignación</th>
                        <th>Acciones</th>
                    </tr>
                </thead>

                <tbody>
                    {% for c in carteras %}
                    <tr>
                        <td>{{ c.nombres }} {{ c.apellidos }}</td>
                        <td>{{ c.NombreContacto }}</td>
                        <td>{{ c.TelefonoContacto }}</td>
                        <td>{{ c.CorreoContacto }}</td>
                        <td>{{ c.FechaAsignacion }}</td>

                        <td class="text-nowrap">
                            <a href="{{ url_for('ver_pedidos', id_cartera=c.IdCartera) }}" class="text-primary me-2">
                                Ver Pedidos
                            </a>

                            <a href="{{ url_for('editar_cartera', id_cartera=c.IdCartera) }}" class="text-warning me-2">
                                Editar
                            </a>

                            <a href="{{ url_for('eliminar_cartera', id_cartera=c.IdCartera) }}"
                                onclick="return confirm('¿Desea eliminar esta cartera?')" class="text-danger">
                                Eliminar
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>

            </table>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="modalCrearCartera" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="fa-solid fa-folder-plus me-2"></i>Nueva Cartera</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <form action="{{ url_for('crear_cartera') }}" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

                <div class="modal-body">

                    <div class="mb-3">
                        <label class="form-label fw-semibold">Usuario asignado</label>
                        <select name="IdUsuario" class="form-select shadow-sm" required>
                            <option value="">Seleccione un vendedor…</option>

                            {% for u in usuarios %}
                            <option value="{{ u.IdUsuario }}">{{ u.Nombres }} {{ u.Apellidos }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-semibold">Nombre del Contacto</label>
                            <input type="text" name="NombreContacto" class="form-control shadow-sm" required>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-semibold">Teléfono</label>
                            <input type="text" name="TelefonoContacto" class="form-control shadow-sm" required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-semibold">Correo</label>
                            <input type="email" name="CorreoContacto" class="form-control shadow-sm" required>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-semibold">Fecha de Asignación</label>
                            <input type="datetime-local" name="FechaAsignacion" class="form-control shadow-sm" required>
                        </div>
                    </div>

                </div>

                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-success px-4">Guardar</button>
                </div>

            </form>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
function confirmarEliminar(url) {
    Swal.fire({
        title: "¿Eliminar Cartera?",
        text: "Esta acción no se puede deshacer.",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#d33",
        cancelButtonColor: "#3085d6",
        confirmButtonText: "Eliminar",
        cancelButtonText: "Cancelar"
    }).then((resultado) => {
        if (resultado.isConfirmed) {
            window.location.href = url;
        }
    });
}
</script>


{% endblock %}