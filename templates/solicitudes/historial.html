{% extends base_template %}
{% block title %}Historial de Solicitudes{% endblock %}
{% block page_title %}Historial de Solicitudes{% endblock %}

{% block content %}
<div class="card shadow p-4">
    <h3 class="fw-bold mb-4">ðŸ“œ Historial de Mis Solicitudes</h3>

    <!-- ðŸ” FILTROS -->
    <form method="GET" action="{{ url_for('historial_solicitudes') }}" class="row g-3 mb-4">
        <div class="col-md-3">
            <label for="fecha_inicio" class="form-label">Desde</label>
            <input type="date" class="form-control" name="fecha_inicio" id="fecha_inicio" value="{{ request.args.get('fecha_inicio', '') }}">
        </div>
        <div class="col-md-3">
            <label for="fecha_fin" class="form-label">Hasta</label>
            <input type="date" class="form-control" name="fecha_fin" id="fecha_fin" value="{{ request.args.get('fecha_fin', '') }}">
        </div>
        <div class="col-md-3">
            <label for="estado" class="form-label">Estado</label>
            <select class="form-select" name="estado" id="estado">
                <option value="">Todos</option>
                <option value="Pendiente" {% if request.args.get('estado') == 'Pendiente' %}selected{% endif %}>Pendiente</option>
                <option value="Aprobada" {% if request.args.get('estado') == 'Aprobada' %}selected{% endif %}>Aprobada</option>
                <option value="Rechazada" {% if request.args.get('estado') == 'Rechazada' %}selected{% endif %}>Rechazada</option>
            </select>
        </div>
        <div class="col-md-3 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">
                <i class="fa-solid fa-filter"></i> Filtrar
            </button>
        </div>
    </form>

    {% if historial %}
    <div class="table-responsive">
        <table class="table table-hover align-middle text-center">
            <thead class="table-light">
                <tr>
                    <th>Tipo</th>
                    <th>Fecha Inicio</th>
                    <th>Fecha Fin</th>
                    <th>DÃ­as</th>
                    <th>Estado</th>
                    <th>JustificaciÃ³n</th>
                    <th>Observaciones</th>
                    <th>Adjunto</th>
                </tr>
            </thead>
            <tbody>
                {% for solicitud in historial %}
                <tr>
                    <td>{{ solicitud.Tipo }}</td>
                    <td>{{ solicitud.FechaInicio }}</td>
                    <td>{{ solicitud.FechaFin }}</td>
                    <td>{{ solicitud.DiasSolicitados }}</td>
                    <td>
                        <span class="badge 
                            {% if solicitud.Estado == 'Pendiente' %}bg-warning text-dark
                            {% elif solicitud.Estado == 'Aprobada' %}bg-success
                            {% else %}bg-danger{% endif %}">
                            {{ solicitud.Estado }}
                        </span>
                    </td>
                    <td>{{ solicitud.Justificacion }}</td>
                    <td>{{ solicitud.Observaciones or 'â€”' }}</td>
                    <td>
                        {% if solicitud.RutaAdjunto %}
                            <a href="{{ url_for('descargar_adjunto', filename=solicitud.RutaAdjunto.split('/')[-1]) }}" 
                               class="btn btn-sm btn-info text-white" target="_blank">
                                <i class="fa-solid fa-download"></i> Descargar
                            </a>
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info text-center mt-3">
        No has enviado ninguna solicitud aÃºn.
    </div>
    {% endif %}
</div>
{% endblock %}
