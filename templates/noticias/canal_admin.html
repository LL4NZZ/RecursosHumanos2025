{% extends "base_admin.html" %}

{% block title %}Gestión de Canal de Noticias{% endblock %}

{% block content %}
<div class="container-fluid py-4">

    <header class="mb-4 d-flex justify-content-between align-items-center">
        <h1 class="h3"><i class="fas fa-newspaper"></i> Administración del Canal de Noticias</h1>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#crearPublicacionModal">
            <i class="fas fa-plus-circle"></i> Nueva Publicación
        </button>
    </header>

    <!-- Tabs -->
    <ul class="nav nav-tabs" id="publicacionTabs" role="tablist">

        <li class="nav-item">
            <button class="nav-link active" id="activas-tab" data-bs-toggle="tab" data-bs-target="#activas"
                type="button" role="tab">
                <i class="fas fa-check-circle"></i> Activas
            </button>
        </li>

        <li class="nav-item">
            <button class="nav-link" id="borradores-tab" data-bs-toggle="tab" data-bs-target="#borradores" type="button"
                role="tab">
                <i class="fas fa-pencil-alt"></i> Borradores
            </button>
        </li>

        <li class="nav-item">
            <button class="nav-link" id="archivadas-tab" data-bs-toggle="tab" data-bs-target="#archivadas" type="button"
                role="tab">
                <i class="fas fa-archive"></i> Archivadas
            </button>
        </li>

    </ul>

    <!-- Contenido de tabs -->
    <div class="tab-content mt-3">

        <div class="tab-pane fade show active" id="activas" role="tabpanel">
            {% include 'noticias/_tabla_activas.html' %}
        </div>

        <div class="tab-pane fade" id="borradores" role="tabpanel">
            {% include 'noticias/_tabla_borradores.html' %}
        </div>

        <div class="tab-pane fade" id="archivadas" role="tabpanel">
            {% include 'noticias/_tabla_archivadas.html' %}
        </div>

    </div>
</div>

{% include "noticias/crear_publicacion.html" %}

{% endblock %}

{% block scripts %}
{{ super() }}

<script>

    // Confirmación de eliminación
    function confirmarEliminacion(id) {
        if (confirm("¿Seguro que deseas eliminar esta publicación? Esta acción no se puede deshacer.")) {
            window.location.href = "{{ url_for('eliminar_publicacion') }}?id=" + id;
        }
    }

    // Evento al abrir modal
    document.getElementById('crearPublicacionModal')
        .addEventListener('show.bs.modal', function (event) {

            let button = event.relatedTarget;
            let idPub = button ? button.getAttribute('data-publicacion-id') : null;
            let estadoPub = button ? button.getAttribute('data-publicacion-estado') : null;

            document.getElementById('formPublicacion').reset();
            document.getElementById('idPublicacionHidden').value = "";
            document.getElementById('estado').value = "Activa";

            if (idPub) {
                document.getElementById('crearPublicacionModalLabel').innerText = "Editar Publicación";
                document.getElementById('idPublicacionHidden').value = idPub;

                if (estadoPub) {
                    document.getElementById('estado').value = estadoPub;
                    if (estadoPub === "Borrador") {
                        document.getElementById('btnGuardarPublicacion').innerText = "Guardar Borrador";
                    } else {
                        document.getElementById('btnGuardarPublicacion').innerText = "Guardar Cambios";
                    }
                }

            } else {
                document.getElementById('crearPublicacionModalLabel').innerText = "Crear Nueva Publicación";
                document.getElementById('btnGuardarPublicacion').innerText = "Publicar";
            }
        });

    // Validación de envío
    function forzarEnvioPublicacion() {
        let titulo = document.getElementById('titulo').value.trim();
        let contenido = document.getElementById('contenido').value.trim();

        if (!titulo || !contenido) {
            alert("Debes completar el Título y el Contenido.");
            return;
        }

        document.getElementById('formPublicacion').submit();
    }

</script>

{% endblock %}