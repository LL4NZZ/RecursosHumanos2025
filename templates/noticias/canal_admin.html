{% extends "base_admin.html" %}

<<<<<<< Updated upstream
{% block title %}Gestión de Canal de Noticias{% endblock %}

{% block content %}
<div class="container-fluid py-4">

    <header class="mb-4 d-flex justify-content-between align-items-center">
        <h1 class="h3"><i class="fas fa-newspaper"></i> Administración del Canal de Noticias</h1>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#crearPublicacionModal">
            <i class="fas fa-plus-circle"></i> Nueva Publicación
        </button>
    </header>

    <!-- Tabs -->
    <ul class="nav nav-tabs" id="publicacionTabs" role="tablist">

        <li class="nav-item">
            <button class="nav-link active" id="activas-tab" data-bs-toggle="tab" data-bs-target="#activas"
                type="button" role="tab">
                <i class="fas fa-check-circle"></i> Activas
            </button>
        </li>

        <li class="nav-item">
            <button class="nav-link" id="borradores-tab" data-bs-toggle="tab" data-bs-target="#borradores" type="button"
                role="tab">
                <i class="fas fa-pencil-alt"></i> Borradores
            </button>
        </li>

        <li class="nav-item">
            <button class="nav-link" id="archivadas-tab" data-bs-toggle="tab" data-bs-target="#archivadas" type="button"
                role="tab">
                <i class="fas fa-archive"></i> Archivadas
            </button>
        </li>

    </ul>

    <!-- Contenido de tabs -->
    <div class="tab-content mt-3">

        <div class="tab-pane fade show active" id="activas" role="tabpanel">
            {% include 'noticias/_tabla_activas.html' %}
        </div>

        <div class="tab-pane fade" id="borradores" role="tabpanel">
            {% include 'noticias/_tabla_borradores.html' %}
        </div>

        <div class="tab-pane fade" id="archivadas" role="tabpanel">
            {% include 'noticias/_tabla_archivadas.html' %}
        </div>

    </div>
</div>

<<<<<<< Updated upstream
{% include "noticias/crear_publicacion.html" %}
=======
<<<<<<< Updated upstream
=======
<<<<<<< Updated upstream
{% include "noticias/crear_publicacion.html" %}
=======
>>>>>>> Stashed changes
<<<<<<< HEAD
{% include "noticias/crear_publicacion.html" %} 
=======
{% include "modals/crear_publicacion.html" %} 
>>>>>>> 851cf041461ac8b5ee8a6c766ed25477410b4757
<<<<<<< Updated upstream
=======
=======
{% block title %}Canal de Noticias{% endblock %}
>>>>>>> Stashed changes
>>>>>>> Stashed changes
>>>>>>> Stashed changes
>>>>>>> Stashed changes

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='Css/canal_noticias.css') }}">
{% endblock %}

<<<<<<< Updated upstream
{% block scripts %}
{{ super() }}

<script>

    // Confirmación de eliminación
    function confirmarEliminacion(id) {
        if (confirm("¿Seguro que deseas eliminar esta publicación? Esta acción no se puede deshacer.")) {
            window.location.href = "{{ url_for('eliminar_publicacion') }}?id=" + id;
        }
    }

    // Evento al abrir modal
    document.getElementById('crearPublicacionModal')
        .addEventListener('show.bs.modal', function (event) {

            let button = event.relatedTarget;
            let idPub = button ? button.getAttribute('data-publicacion-id') : null;
            let estadoPub = button ? button.getAttribute('data-publicacion-estado') : null;

            document.getElementById('formPublicacion').reset();
            document.getElementById('idPublicacionHidden').value = "";
            document.getElementById('estado').value = "Activa";

            if (idPub) {
                document.getElementById('crearPublicacionModalLabel').innerText = "Editar Publicación";
                document.getElementById('idPublicacionHidden').value = idPub;

                if (estadoPub) {
                    document.getElementById('estado').value = estadoPub;
                    if (estadoPub === "Borrador") {
                        document.getElementById('btnGuardarPublicacion').innerText = "Guardar Borrador";
                    } else {
                        document.getElementById('btnGuardarPublicacion').innerText = "Guardar Cambios";
                    }
                }

            } else {
                document.getElementById('crearPublicacionModalLabel').innerText = "Crear Nueva Publicación";
                document.getElementById('btnGuardarPublicacion').innerText = "Publicar";
            }
        });

    // Validación de envío
    function forzarEnvioPublicacion() {
        let titulo = document.getElementById('titulo').value.trim();
        let contenido = document.getElementById('contenido').value.trim();

        if (!titulo || !contenido) {
            alert("Debes completar el Título y el Contenido.");
            return;
        }

        document.getElementById('formPublicacion').submit();
    }

</script>

<<<<<<< Updated upstream
=======
<<<<<<< Updated upstream
=======
<<<<<<< Updated upstream
=======
>>>>>>> Stashed changes
            } else {
                // Configuración para nuevo
                $('#crearPublicacionModalLabel').text('Crear Nueva Publicación');
                $('#btnGuardarPublicacion').text('Publicar');
                // Asegurar que el formulario esté limpio
                $('#formPublicacion')[0].reset();
            }
        });
>>>>>>> 851cf041461ac8b5ee8a6c766ed25477410b4757
    </script>
<<<<<<< Updated upstream
=======
=======
{% block content %}
<div class="container py-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fa-solid fa-newspaper"></i> Canal de Noticias</h2>

        <!-- Botón crear (ya NO usa modal) --> 
        <a href="{{ url_for('crear_publicacion') }}" class="btn btn-primary rounded-pill px-4">
            <i class="fa-solid fa-plus"></i> Nueva Publicación
        </a>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">

            {% if publicaciones %}
            <div class="table-responsive"> <!-- Asegúrate de que esta línea esté aquí -->
                <table class="table table-striped align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Título</th>
                            <th>Autor</th>
                            <th>Fecha Publicación</th>
                            <th>Modificación</th>
                            <th>Estado</th>
                            <th class="text-center">Acciones</th>
                        </tr>
                    </thead>

                    <tbody>
                        {% for p in publicaciones %}
                        <tr>
                            <td>{{ p.Titulo }}</td>
                            <td>{{ p.Autor }}</td>
                            <td>{{ p.FechaPublicacion }}</td>
                            <td>{{ p.FechaModificacion or "—" }}</td>

                            <td>
                                <span class="badge {{ 'bg-success' if p.Estado=='Publicada' else 'bg-secondary' }} text-white">
                                    {{ p.Estado }}
                                </span>
                            </td>

                            <td class="text-center">

                                <!-- Editar - abre página -->
                                <a href="{{ url_for('editar_publicacion', id=p.IdNoticia) }}" class="btn btn-warning btn-sm me-1">
                                    <i class="fas fa-edit"></i>
                                </a>

                                <!-- Eliminar -->
                                <a href="{{ url_for('eliminar_publicacion') }}?id={{ p.IdNoticia }}"
                                    class="btn btn-danger btn-sm" onclick="return confirm('¿Eliminar esta publicación?');">
                                    <i class="fa-solid fa-trash"></i>
                                </a>

                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            {% else %}
            <div class="alert alert-info text-center mb-0">
                No hay publicaciones.
            </div>
            {% endif %}

        </div>
    </div>

</div>
>>>>>>> Stashed changes
>>>>>>> Stashed changes
>>>>>>> Stashed changes
>>>>>>> Stashed changes
{% endblock %}