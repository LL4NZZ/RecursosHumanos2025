{# Detectar pestaña actual #}
{% set tab_id = loop.index %}
{% if tab_id == 1 %}
{% set publicaciones = publicaciones_activas %}
{% set estado_actual = 'Activa' %}
{% elif tab_id == 2 %}
{% set publicaciones = publicaciones_borradores %}
{% set estado_actual = 'Borrador' %}
{% else %}
{% set publicaciones = publicaciones_archivadas %}
{% set estado_actual = 'Archivada' %}
{% endif %}

<div class="card shadow mb-4">

    <div class="card-header py-3">
        <h6 class="m-0 fw-bold text-{{ 
            'primary' if estado_actual == 'Activa' 
            else 'warning' if estado_actual == 'Borrador'
            else 'secondary' }}">
            Publicaciones en estado: {{ estado_actual }}
        </h6>
    </div>

    <div class="card-body">

        {% if publicaciones %}
        <div class="table-responsive">
            <table class="table table-bordered table-hover align-middle">

                <thead class="table-light">
                    <tr>
                        <th>Título</th>
                        <th>Autor</th>

                        {% if estado_actual == 'Borrador' %}
                        <th>Fecha Creación</th>
                        {% elif estado_actual == 'Archivada' %}
                        <th>Fecha Archivado</th>
                        {% else %}
                        <th>Fecha Publicación</th>
                        <th>Vigencia</th>
                        {% endif %}

                        <th class="text-center">Acciones</th>
                    </tr>
                </thead>

                <tbody>
                    {% for p in publicaciones %}
                    <tr>
                        <td class="fw-semibold">{{ p.Titulo }}</td>
                        <td>{{ p.Autor }}</td>

                        {% if estado_actual == 'Borrador' %}
                        <td>{{ p.FechaCreacion }}</td>

                        {% elif estado_actual == 'Archivada' %}
                        <td>{{ p.FechaModificacion }}</td>

                        {% else %}
                        <td>{{ p.FechaPublicacion or "Inmediata" }}</td>
                        <td>{{ p.FechaVigencia or "Indefinida" }}</td>
                        {% endif %}

                        <td class="text-center">

                            <!-- EDITAR -->
                            <button class="btn btn-warning btn-sm me-1" data-bs-toggle="modal"
                                data-bs-target="#crearPublicacionModal" data-publicacion-id="{{ p.IdNoticia }}"
                                data-publicacion-estado="{{ p.Estado }}">
                                <i class="fas fa-edit"></i>
                            </button>

                            <!-- CAMBIAR ESTADO (solo activas y borradores) -->
                            {% if estado_actual != 'Archivada' %}
                            {% set siguiente_estado = 'Archivada' if estado_actual == 'Activa' else 'Activa' %}
                            <a href="{{ url_for('cambiar_estado_publicacion', id=p.IdNoticia, estado=siguiente_estado) }}"
                                class="btn btn-sm {{ 'btn-secondary' if estado_actual == 'Activa' else 'btn-success' }} me-1"
                                onclick="return confirm('¿Cambiar estado de esta publicación?');">
                                <i class="{{ 'fas fa-archive' if estado_actual == 'Activa' else 'fas fa-upload' }}"></i>
                            </a>
                            {% endif %}

                            <!-- ELIMINAR -->
                            <button class="btn btn-danger btn-sm" onclick="confirmarEliminacion('{{ p.IdNoticia }}')">
                                <i class="fas fa-trash"></i>
                            </button>

                        </td>
                    </tr>
                    {% endfor %}
                </tbody>

            </table>
        </div>

        {% else %}
        <div class="alert alert-info text-center">
            No hay publicaciones en estado <b>{{ estado_actual }}</b>.
        </div>
        {% endif %}

    </div>
</div>