{# Lógica para determinar qué lista de publicaciones usar, basándose en el ID de la pestaña contenedora. #}

{% set tab_id = loop.index %}
{% set publicaciones = publicaciones_activas %}
{% set estado_actual = 'Activa' %}

{% if tab_id == 1 %}
    {% set publicaciones = publicaciones_activas %}
    {% set estado_actual = 'Activa' %}
{% elif tab_id == 2 %}
    {% set publicaciones = publicaciones_borradores %}
    {% set estado_actual = 'Borrador' %}
{% elif tab_id == 3 %}
    {% set publicaciones = publicaciones_archivadas %}
    {% set estado_actual = 'Archivada' %}
{% endif %}

<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-{{ 'primary' if estado_actual == 'Activa' else 'warning' if estado_actual == 'Borrador' else 'secondary' }}">
            Publicaciones en estado: {{ estado_actual }}
        </h6>
    </div>
    <div class="card-body">
        {% if publicaciones %}
        <div class="table-responsive">
            <table class="table table-bordered table-hover" width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th>Título</th>
                        <th>Autor</th>
                        <th>Fecha Publicación</th>
                        <th>Vigencia</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for publicacion in publicaciones %}
                    <tr>
                        <td>{{ publicacion.Titulo }}</td>
                        <td>{{ publicacion.Autor }}</td>
                        <td>{{ publicacion.FechaPublicacion | default("Inmediata") }}</td>
                        <td>{{ publicacion.FechaVigencia | default("Indefinida") }}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" title="Editar" 
                                    data-toggle="modal" data-target="#crearPublicacionModal"
                                    data-publicacion-id="{{ publicacion.IdPublicacion }}">
                                <i class="fas fa-edit"></i>
                            </button>
                            
                            {% if estado_actual == 'Activa' or estado_actual == 'Borrador' %}
                            {% set siguiente_estado = 'Archivada' if estado_actual == 'Activa' else 'Activa' %}
                            {% set clase_btn = 'btn-secondary' if estado_actual == 'Activa' else 'btn-success' %}
                            {% set icono_btn = 'fas fa-archive' if estado_actual == 'Activa' else 'fas fa-upload' %}
                            <a href="{{ url_for('cambiar_estado_publicacion', id=publicacion.IdPublicacion, estado=siguiente_estado) }}" 
                               class="btn btn-sm {{ clase_btn }}" title="{{ 'Archivar' if estado_actual == 'Activa' else 'Publicar' }}">
                                <i class="{{ icono_btn }}"></i>
                            </a>
                            {% endif %}
                            
                            <button class="btn btn-sm btn-danger" title="Eliminar" onclick="confirmarEliminacion('{{ publicacion.IdPublicacion }}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info text-center">
            No hay publicaciones en estado **{{ estado_actual }}** en este momento.
        </div>
        {% endif %}
    </div>
</div>